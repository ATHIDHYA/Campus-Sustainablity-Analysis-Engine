{% extends "base.html" %}
{% block title %}Dashboard{% endblock %}

{% block content %}

<!-- ================= KPI SECTION ================= -->
<div class="kpi-grid">

    <div class="kpi-card">
        <h3>âš¡ Avg Energy</h3>
        <p>{{ avg_energy }} kWh</p>
    </div>

    <div class="kpi-card">
        <h3>ğŸ’§ Avg Water</h3>
        <p>{{ avg_water }} L</p>
    </div>

    <div class="kpi-card">
        <h3>ğŸ—‘ Avg Waste</h3>
        <p>{{ avg_waste }} kg</p>
    </div>

    <div class="kpi-card">
        <h3>ğŸŒ³ Avg Greenery</h3>
        <p>{{ avg_greenery }} sq.m</p>
    </div>

    <div class="kpi-card highlight">
        <h3>ğŸ“Š Overall Score</h3>
        <p>{{ overall_score }}</p>
    </div>

    <div class="kpi-card highlight">
        <h3>ğŸ† Grade</h3>
        <p>{{ grade }}</p>
    </div>
                {% if predicted_score %}
<div class="kpi-card highlight">
    <h3>ğŸ”® Next Month Prediction</h3>
    <p>{{ predicted_score }}</p>
    <small>{{ trend }}</small>
</div>
{% endif %}

</div>

<!-- ================= MAIN DASHBOARD ================= -->
<div class="dashboard-grid">

    <div class="card">
        <h2>ğŸ“Š Sustainability Scores</h2>
        <canvas id="scoreChart"></canvas>
    </div>

    <div class="card menu">
        <h2>âš™ Actions</h2>
        <ul>
            <li><a href="{{ url_for('dataentry.energy_entry') }}">âš¡ Energy Entry</a></li>
            <li><a href="{{ url_for('dataentry.water_entry') }}">ğŸ’§ Water Entry</a></li>
            <li><a href="{{ url_for('dataentry.waste_entry') }}">ğŸ—‘ Waste Entry</a></li>
            <li><a href="{{ url_for('dataentry.greenery_entry') }}">ğŸŒ³ Greenery Entry</a></li>

            {% if role == "admin" %}
                <li><a href="/add_user">ğŸ‘¤ Add User</a></li>
                <li><a href="{{ url_for('manageuser.manage_users') }}">ğŸ‘¥ Manage Users</a></li>

            {% endif %}

            <li><a href="/export_pdf">ğŸ“„ Download Report</a></li>
        </ul>
    </div>

</div>

<!-- ================= CHART ================= -->
<script>
const ctx = document.getElementById('scoreChart');

new Chart(ctx, {
    type: 'line',
    data: {
        labels: {{ labels | safe }},
        datasets: [{
            label: 'Sustainability Score',
            data: {{ scores | safe }},
            tension: 0.3,
            fill: false
        }]
    },
    options: {
        scales: {
            y: { beginAtZero: true, max: 100 }
        }
    }
});
</script>


{% endblock %}
